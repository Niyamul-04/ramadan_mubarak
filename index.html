<!DOCTYPE html>
<html lang="en">
<head> 
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ramadan Light ¬∑ Responsive Hand Draw</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { 
      background: #0b0804; 
      overflow: hidden; 
      font-family: 'Amiri', serif; 
      position: relative; 
      color: white;
      touch-action: none; 
      height: 100vh;
      width: 100vw;
    }

    video { display: none; }
    canvas { 
      width: 100%; height: 100%; 
      transform: scaleX(-1); 
      position: absolute; top: 0; left: 0; 
      z-index: 2; cursor: none; display: block;
    }

    .start-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      pointer-events: none; 
    }

    #start-btn {
      pointer-events: auto; 
      padding: 18px 45px;
      font-size: 1.6rem;
      font-weight: bold;
      background: #d4af37;
      color: #0b0804;
      border: none;
      border-radius: 60px;
      box-shadow: 0 0 40px #f5d061;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-family: 'Amiri', serif;
      white-space: nowrap;
    }

    #start-btn:active {
      transform: scale(0.95);
    }

    #clearBtn, #eraseBtn {
      position: absolute;
      top: 16px;
      z-index: 50;
      font-weight: bold;
      border: none;
      border-radius: 40px;
      background: #f5d061;
      color: #0b0804;
      padding: 10px 22px;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: 0 0 20px rgba(245,208,97,0.5);
    }

    #clearBtn { right: 150px; }
    #eraseBtn { right: 30px; }
    
    #eraseBtn.active {
      background: #ff5c5c;
      box-shadow: 0 0 18px #ff5c5c;
      color: white;
    }

    @media (max-width: 600px) {
      #start-btn { padding: 15px 35px; font-size: 1.3rem; }
      #clearBtn { right: 120px; padding: 8px 18px; font-size: 0.9rem; }
      #eraseBtn { right: 20px; padding: 8px 18px; font-size: 0.9rem; }
      .branding { font-size: 1.4rem !important; right: 20px !important; bottom: 20px !important; }
      .instructions { font-size: 0.85rem !important; left: 20px !important; bottom: 20px !important; }
    }

    .branding {
      position: absolute; bottom: 24px; right: 30px; z-index: 10; color: #d4af37;
      font-size: 2rem; font-weight: 700; text-shadow: 0 0 20px rgba(245, 208, 97, 0.8);
      letter-spacing: 4px; opacity: 0.8; background: rgba(10, 6, 2, 0.4);
      padding: 8px 25px; border-radius: 60px; backdrop-filter: blur(4px);
      border: 1px solid rgba(245, 208, 97, 0.3); pointer-events: none;
    }

    .instructions {
      position: absolute; bottom: 30px; left: 30px; z-index: 10; color: #ecd9b4;
      background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px);
      padding: 16px 28px; border-radius: 50px; border-left: 6px solid #f5d061;
      font-size: 1.1rem; pointer-events: none;
    }

    .lantern { 
      position: absolute; top: 20px; left: 30px; z-index: 5; 
      font-size: 2.5rem; opacity: 0.2; color: #f5d061; pointer-events: none;
    }
  </style>
</head>
<body>

  <div class="start-overlay" id="overlay">
    <button id="start-btn">‚ú® Begin Experience</button>
  </div>

  <button id="clearBtn">üóëÔ∏è Clear</button>
  <button id="eraseBtn">üßΩ Erase</button>

  <div class="lantern">üèÆüèÆüèÆüèÆ</div>
  <div class="branding">ÿ±ŸÖÿ∂ÿßŸÜ ŸÉÿ±ŸäŸÖ</div>
  <div class="instructions">
    ‚òùüèΩ Finger Move ¬∑ SHIFT/Touch Draw
  </div>

  <video id="vid" playsinline></video>
  <canvas id="c"></canvas>

  <script>
    (function() {
      const vid = document.getElementById('vid');
      const canvas = document.getElementById('c');
      const ctx = canvas.getContext('2d');
      const startBtn = document.getElementById('start-btn');
      const overlay = document.getElementById('overlay');
      const clearBtn = document.getElementById('clearBtn');
      const eraseBtn = document.getElementById('eraseBtn');

      let strokes = [];
      let currentStroke = [];
      let shiftPressed = false;
      let isDrawing = false;
      let eraseMode = false;
      let smoothX = null;
      let smoothY = null;

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      window.addEventListener('resize', resizeCanvas);
      resizeCanvas();

      function onHandResults(results) {
        const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
        grad.addColorStop(0, '#0f0c08');
        grad.addColorStop(1, '#050301');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.shadowColor = '#F5D061';
        ctx.shadowBlur = 20;
        ctx.strokeStyle = '#F5D061';
        ctx.lineWidth = 7;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        strokes.forEach(stroke => {
          if (stroke.length < 2) return;
          ctx.beginPath();
          ctx.moveTo(stroke[0].x, stroke[0].y);
          stroke.forEach(p => ctx.lineTo(p.x, p.y));
          ctx.stroke();
        });

        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
          const landmarks = results.multiHandLandmarks[0];
          drawConnectors(ctx, landmarks, HAND_CONNECTIONS, {color: 'rgba(245, 208, 97, 0.3)', lineWidth: 4});
          drawLandmarks(ctx, landmarks, {color: '#FFD700', lineWidth: 1, radius: 5});

          const indexTip = landmarks[8];
          const rawX = indexTip.x * canvas.width;
          const rawY = indexTip.y * canvas.height;

          if (smoothX === null) { smoothX = rawX; smoothY = rawY; }
          else {
            smoothX += (rawX - smoothX) * 0.35;
            smoothY += (rawY - smoothY) * 0.35;
          }

          if (eraseMode) {
            strokes = strokes.map(s => s.filter(p => Math.hypot(p.x - smoothX, p.y - smoothY) > 45)).filter(s => s.length > 0);
            ctx.beginPath();
            ctx.arc(smoothX, smoothY, 40, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(255, 92, 92, 0.6)';
            ctx.stroke();
          }

          ctx.shadowBlur = 30;
          ctx.fillStyle = shiftPressed ? '#FFFFFF' : (eraseMode ? '#ff5c5c' : '#f5d061');
          ctx.beginPath();
          ctx.arc(smoothX, smoothY, 15, 0, Math.PI * 2);
          ctx.fill();

          if (shiftPressed && !eraseMode) {
            if (!isDrawing) { isDrawing = true; currentStroke = []; strokes.push(currentStroke); }
            currentStroke.push({ x: smoothX, y: smoothY });
          } else { isDrawing = false; }
        } else {
          smoothX = null; smoothY = null;
        }
      }

      const hands = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
      hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.6, minTrackingConfidence: 0.6 });
      hands.onResults(onHandResults);

      const camera = new Camera(vid, {
        onFrame: async () => { await hands.send({ image: vid }); },
        width: 1280, height: 720
      });

      startBtn.onclick = () => {
        camera.start();
        overlay.style.display = 'none'; 
      };

      clearBtn.onclick = () => { strokes = []; };

      eraseBtn.addEventListener('pointerdown', (e) => { e.stopPropagation(); eraseMode = true; eraseBtn.classList.add('active'); });
      eraseBtn.addEventListener('pointerup', () => { eraseMode = false; eraseBtn.classList.remove('active'); });
      eraseBtn.addEventListener('pointerleave', () => { eraseMode = false; eraseBtn.classList.remove('active'); });

      // Keyboard Controls
      window.addEventListener('keydown', (e) => {
        if (e.key === 'Shift') shiftPressed = true;
        if (e.code === 'Space') strokes = [];
      });
      window.addEventListener('keyup', (e) => {
        if (e.key === 'Shift') shiftPressed = false;
      });

      // Mobile/Android Touch Draw Support
      window.addEventListener('pointerdown', (e) => {
          if(e.target.tagName !== 'BUTTON') shiftPressed = true;
      });
      window.addEventListener('pointerup', () => {
          shiftPressed = false;
      });

    })();
  </script>
</body>
</html>